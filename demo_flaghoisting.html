<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Virtual Flag Hoisting Ceremony ‚Äî Pakistan</title>
  <meta name="description" content="Hoist Pakistan's flag online, listen to the anthem, and leave your wish on a live wall." />
  <style>
    :root{
      --green:#0a7d44; /* deep flag green */
      --green-2:#0f9d58; /* lighter accent */
      --white:#f7f7f7;
      --gold:#d4b15a;
      --bg1:#052515; --bg2:#0b3d25; --bg3:#0d5a35;
      --glass:rgba(255,255,255,.08);
      --border:rgba(255,255,255,.14);
      --shadow:0 14px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{margin:0;font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, sans-serif;color:var(--white);
      background: radial-gradient(1200px 800px at -10% -20%, rgba(255,255,255,.10), transparent 60%),
      linear-gradient(135deg, var(--bg1), var(--bg2) 50%, var(--bg3));
      overflow-x:hidden;
    }

    header{position:sticky;top:0;z-index:40;backdrop-filter: blur(10px);
      background:linear-gradient(180deg, rgba(7,30,20,.85), rgba(7,30,20,.55));
      border-bottom:1px solid var(--border)}
    .container{max-width:1100px;margin:0 auto;padding:14px 16px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .flag-mini{width:38px;height:26px;border:2px solid #fff;border-radius:3px;box-shadow:var(--shadow);
      background:linear-gradient(90deg, var(--green) 70%, #fff 70% 100%);position:relative}
    .flag-mini::after{content:"‚òÖ";position:absolute;left:6px;top:50%;transform:translateY(-50%);color:#fff;text-shadow:0 0 6px rgba(0,0,0,.4)}
    .brand h1{font-size:18px;margin:0}
    .actions{display:flex;flex-wrap:wrap;gap:8px}

    button, .btn{cursor:pointer;border:none;border-radius:14px;padding:10px 14px;font-weight:650;
      background:linear-gradient(180deg, #1aa05a, #168e50);color:white;box-shadow:var(--shadow);text-decoration:none}
    button.secondary{background:linear-gradient(180deg,#1b3e2c,#132e21)}
    button.ghost{background:transparent;border:1px solid var(--border)}

    /* ====== Scene ====== */
    .scene{position:relative;min-height:84vh;display:grid;place-items:center;overflow:hidden}
    .sky{position:absolute;inset:0;background:
            radial-gradient(1200px 700px at 20% -10%, rgba(255,255,255,.15), transparent 60%),
            linear-gradient(180deg, #0d4b2e 0%, #0a3b26 50%, #062318 100%)}
    .sun{position:absolute;top:12%;left:12%;width:220px;height:220px;border-radius:50%;
      background: radial-gradient(circle at 40% 40%, #fff, #ffe9b3 40%, rgba(255,255,255,.0) 60%);
      filter: blur(1px);opacity:.9;mix-blend-mode:screen}

    .ground{position:absolute;left:0;right:0;bottom:-40px;height:220px;background:
            radial-gradient(1200px 300px at 50% -120px, rgba(0,0,0,.35), rgba(0,0,0,0) 60%),
            linear-gradient(180deg, #0c2c1d, #061b12)}

    .pole-wrap{position:relative;width:min(90vw, 980px);height:min(70vh,620px)}
    .pole{position:absolute;left:52%;bottom:12%;width:8px;height:72%;background:linear-gradient(180deg,#eee,#ccc);
      border:1px solid rgba(0,0,0,.2);box-shadow:inset -1px 0 1px rgba(0,0,0,.2)}
    .finial{position:absolute;left:calc(52% - 8px);bottom:calc(12% + 72% - 12px);width:18px;height:18px;border-radius:50%;
      background:radial-gradient(circle at 35% 35%, #fff, #e6d28c 60%, #a4882e);box-shadow:0 2px 8px rgba(0,0,0,.4)}

    /* Flag (pure CSS) */
    .flag{position:absolute;left:calc(52% + 8px);bottom:12%;width:min(44vw,520px);height:min(26vw,300px);
      transform-origin:left center;transform:translateY(0); /* starts bottom; we animate translateY */}
    .cloth{position:absolute;inset:0;border:2px solid #fff;border-left:none;box-shadow:var(--shadow);
      background:linear-gradient(90deg, var(--green) 70%, #fff 70% 100%);
      clip-path:polygon(0 0, 100% 0, 100% 100%, 0 100%); /* rectangular */
      animation: wave 2.4s ease-in-out infinite}
    .moon-star{position:absolute;left:6%;top:50%;transform:translateY(-50%);width:30%;height:60%;}
    .crescent{position:absolute;left:6%;top:20%;width:52%;height:60%;border-radius:50%;
      box-shadow: inset -30px 0 0 30px #fff; /* creates crescent with inner cut */
      background:transparent}
    .crescent::after{content:'';position:absolute;left:18%;top:8%;width:60%;height:80%;border-radius:50%;
      background:var(--green);}
    .star{position:absolute;left:62%;top:44%;width:22%;aspect-ratio:1; background: conic-gradient(from 18deg,#fff 0 36deg,transparent 0) 50% 0/10% 50% no-repeat,
    conic-gradient(from 90deg,#fff 0 36deg,transparent 0) 100% 37%/50% 10% no-repeat,
    conic-gradient(from 162deg,#fff 0 36deg,transparent 0) 50% 100%/10% 50% no-repeat,
    conic-gradient(from 234deg,#fff 0 36deg,transparent 0) 0 63%/50% 10% no-repeat,
    conic-gradient(from 306deg,#fff 0 36deg,transparent 0) 0 37%/50% 10% no-repeat; /* 5-point hack */
      filter: drop-shadow(0 0 2px rgba(0,0,0,.3))}

    @keyframes wave{
      0%,100%{transform:skewX(0) scaleX(1)}
      25%{transform:skewX(-2deg) scaleX(1.02)}
      50%{transform:skewX(2deg) scaleX(.98)}
      75%{transform:skewX(-2deg) scaleX(1.01)}
    }

    .cta{position:absolute;inset:0;display:grid;place-items:center;z-index:5}
    .cta-card{background:linear-gradient(180deg, rgba(15,37,28,.9), rgba(13,32,24,.85));border:1px solid var(--border);
      border-radius:18px;padding:18px 18px 16px;text-align:center;box-shadow:var(--shadow);max-width:560px}
    .cta h2{margin:10px 0 6px;font-size:clamp(22px,5vw,34px)}
    .cta p{margin:0 0 12px;opacity:.92}

    .hud{position:absolute;inset:18px 18px auto auto;display:flex;gap:8px;z-index:6}

    /* After hoist reveal */
    .celebrate{position:absolute;inset:0;display:none;place-items:center;text-align:center;z-index:8}
    .celebrate .msg{font-weight:900;font-size: clamp(28px, 6vw, 54px);text-shadow:0 6px 18px rgba(0,0,0,.4)}
    .celebrate.show{display:grid;animation: fade .9s ease both}
    @keyframes fade{from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)}}

    /* ===== Wish Wall ===== */
    .section{padding:26px 0}
    .card{background:linear-gradient(180deg, rgba(15,37,28,.85), rgba(13,32,24,.85));border:1px solid var(--border);border-radius:18px;padding:16px;box-shadow:var(--shadow)}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0}
    .controls select,.controls input{background:rgba(0,0,0,.25);color:#fff;border:1px solid var(--border);padding:10px 12px;border-radius:12px}
    .controls input{flex:1 1 220px}
    .grid{display:grid;gap:12px;grid-template-columns: repeat(auto-fill, minmax(220px,1fr));margin-top:12px}
    .wish{position:relative;overflow:hidden;border-radius:16px;border:1px solid var(--border);padding:14px;
      background: radial-gradient(700px 260px at -10% -20%, rgba(255,255,255,.12), transparent 35%),
      linear-gradient(180deg, rgba(41,92,66,.9), rgba(21,58,41,.9));
    }
    .wish .metaRow{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:10px;font-size:12px;opacity:.9}

    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:var(--glass);border:1px solid var(--border)}

    footer{position:sticky;bottom:0;background: linear-gradient(0deg, rgba(10,32,22,.85), rgba(10,32,22,.55));border-top:1px solid var(--border)}
    .footer-wrap{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 16px}

    /* Confetti & fireworks canvas */
    #confetti, #fireworks{position:fixed;inset:0;pointer-events:none;z-index:7;mix-blend-mode:screen}

    @media (max-width: 900px){
      .pole-wrap{height:62vh}
    }
  </style>
</head>
<body>
<canvas id="confetti"></canvas>
<canvas id="fireworks"></canvas>

<header>
  <div class="container row">
    <div class="brand">
      <div class="flag-mini" aria-hidden="true"></div>
      <h1>Virtual Flag Hoisting ‚Äî Pakistan</h1>
    </div>
    <div class="actions">
      <button class="ghost" id="btnMute" aria-pressed="true" title="Toggle anthem">üîà Sound</button>
      <button class="secondary" id="btnCelebrate" title="Celebrate now">üéÜ Celebrate</button>
      <a class="btn" id="btnShare">üì§ Share</a>
    </div>
  </div>
</header>

<main>
  <!-- ===== Flag Scene ===== -->
  <section class="scene">
    <div class="sky"></div>
    <div class="sun"></div>
    <div class="ground"></div>

    <div class="pole-wrap" aria-live="polite">
      <div class="pole" aria-hidden="true"></div>
      <div class="finial" aria-hidden="true"></div>

      <!-- Flag element (animated upward) -->
      <div id="flag" class="flag" style="transform: translateY(52%);">
        <div class="cloth"></div>
        <div class="moon-star" aria-hidden="true">
          <div class="crescent"></div>
          <div class="star"></div>
        </div>
      </div>
    </div>

    <!-- HUD top-right: counter -->
    <div class="hud">
      <span class="pill" id="counter">üë• 0 joined</span>
      <span class="pill" id="timer">‚è≥ 14 August countdown: --:--:--</span>
    </div>

    <!-- CTA card -->
    <div class="cta" id="cta">
      <div class="cta-card">
        <h2>Click to Hoist the Flag</h2>
        <p>Join the ceremony, play the anthem, and celebrate Independence Day online. üáµüá∞</p>
        <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
          <button id="btnHoist">üè¥‚Äç‚ò†Ô∏è Hoist Now</button>
          <button class="secondary" id="btnPreview">üëÄ Preview Motion</button>
        </div>
        <small style="display:block;margin-top:8px;opacity:.85">Tip: Audio will play after your click (browser policy).</small>
      </div>
    </div>

    <!-- Celebration message -->
    <div id="celebrate" class="celebrate">
      <div>
        <div class="msg">Ÿæÿß⁄©ÿ≥ÿ™ÿßŸÜ ÿ≤ŸÜÿØ€Å ÿ®ÿßÿØ ‚Ä¢ Pakistan Zindabad!</div>
        <p style="opacity:.9">Add your wish below to join the Digital Wish Wall.</p>
        <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
          <a href="#wish-section" class="btn">‚ûï Add a Wish</a>
          <button class="secondary" id="btnReplay">‚Ü©Ô∏è Replay Hoist</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== Wish Wall ===== -->
  <section id="wish-section" class="section container">
    <div class="row" style="align-items:flex-start;gap:20px">
      <div style="flex:1 1 520px">
        <h2 style="margin:6px 0 8px;font-size:clamp(22px,5vw,32px)">Digital Wish Wall</h2>
        <p style="margin-top:0;opacity:.9">Write your wish for Pakistan‚Äôs future and see it appear below. (Prototype stores locally in your browser.)</p>

        <div class="card" style="margin-top:10px">
          <form id="wishForm" autocomplete="off" style="display:grid;gap:10px">
            <label>
              <strong>Your Name (optional)</strong>
              <input id="name" type="text" maxlength="40" placeholder="e.g., Ayesha / Ali / Anonymous" style="width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:rgba(0,0,0,.25);color:#fff"/>
            </label>
            <label>
              <strong>Your Wish</strong>
              <textarea id="wish" maxlength="240" placeholder="Write from the heart‚Ä¶ (max 240 characters)" style="width:100%;min-height:96px;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:rgba(0,0,0,.25);color:#fff"></textarea>
            </label>
            <div class="row" style="gap:10px;flex-wrap:wrap">
              <label style="flex:1 1 160px">
                <strong>Language</strong>
                <select id="lang" style="width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:rgba(0,0,0,.25);color:#fff">
                  <option value="auto">Auto-detect</option>
                  <option value="ur">Urdu</option>
                  <option value="en">English</option>
                </select>
              </label>
              <label style="flex:1 1 160px">
                <strong>City (optional)</strong>
                <input id="city" type="text" maxlength="40" placeholder="Lahore, Karachi, Islamabad‚Ä¶" style="width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:rgba(0,0,0,.25);color:#fff"/>
              </label>
            </div>
            <div class="row" style="gap:10px;flex-wrap:wrap">
              <button type="submit">‚ûï Add Wish</button>
              <button type="button" class="secondary" id="btnClear">üßπ Clear All (local)</button>
            </div>
            <small style="opacity:.8">Connect a database (Firebase/Supabase) later for real-time, multi-user updates.</small>
          </form>
        </div>
      </div>

      <div class="card" style="flex:1 1 420px">
        <div class="controls">
          <span class="pill" id="wishCount">üìù 0 wishes</span>
          <span class="pill" id="loveCount">‚ù§Ô∏è 0 hearts</span>
          <select id="filterLang" title="Filter by language">
            <option value="all">All languages</option>
            <option value="ur">Urdu</option>
            <option value="en">English</option>
          </select>
          <select id="sortBy" title="Sort wishes">
            <option value="latest">Latest</option>
            <option value="hearts">Most loved</option>
          </select>
          <input id="search" type="text" placeholder="Search wishes‚Ä¶" />
        </div>
        <div id="grid" class="grid" role="list"></div>
        <div id="empty" style="opacity:.8;text-align:center;padding:20px">No wishes yet. Be the first to add one! üí´</div>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="footer-wrap container">
    <div>¬© <span id="yr"></span> Virtual Flag Hoisting ‚Ä¢ Made with üíö in Pakistan</div>
    <div class="pill" id="footCount">üë• 0 joined</div>
  </div>
</footer>

<audio id="anthem" preload="auto">
  <source src="https://upload.wikimedia.org/wikipedia/commons/5/5e/National_anthem_of_Pakistan_instrumental.ogg" type="audio/ogg">
</audio>

<script>
  // ===== Helpers =====
  const $ = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);
  const random = (min,max)=> Math.random()*(max-min)+min;
  const fmtTime = ms => { const t=Math.max(0,Math.floor(ms/1000)); const h=String(Math.floor(t/3600)).padStart(2,'0'); const m=String(Math.floor((t%3600)/60)).padStart(2,'0'); const s=String(t%60).padStart(2,'0'); return `${h}:${m}:${s}`; };
  const isUrduGuess = txt => /[\u0600-\u06FF]/.test(txt);

  // ===== Counters & Storage =====
  const storeKey='pk-wishes-v2';
  const joinedKey='pk-joined';
  const heartKey = id => `pk-heart-${id}`;

  let wishes=[]; try{wishes=JSON.parse(localStorage.getItem(storeKey))||[]}catch{wishes=[]}
  let joined = Number(localStorage.getItem(joinedKey)||0);

  // Seed sample wishes on first visit
  if(!localStorage.getItem('pk-seeded-v2')){
    const seed=[
      { id: crypto.randomUUID(), name:'Ayesha', city:'Lahore', lang:'ur', text:'Ÿæÿß⁄©ÿ≥ÿ™ÿßŸÜ €ÅŸÖ€åÿ¥€Å ÿ™ÿ±ŸÇŸë€å ⁄©ÿ±€íÿå ÿ™ÿπŸÑ€åŸÖ ŸÖÿ∂ÿ®Ÿàÿ∑ €ÅŸàÿå ÿßŸÜÿµÿßŸÅ ÿ≥ÿ® ⁄©€í ŸÑ€å€í€î', hearts: 7, ts: Date.now()-3600_000 },
      { id: crypto.randomUUID(), name:'Ali', city:'Karachi', lang:'en', text:'May our homeland prosper in unity, faith, and discipline.', hearts: 10, ts: Date.now()-7200_000 },
      { id: crypto.randomUUID(), name:'Zeeshan', city:'Islamabad', lang:'en', text:'A greener, cleaner Pakistan with opportunities for every child.', hearts: 5, ts: Date.now()-5400_000 }
    ];
    wishes=[...seed,...wishes];
    localStorage.setItem(storeKey, JSON.stringify(wishes));
    localStorage.setItem('pk-seeded-v2','1');
  }

  // ===== Audio =====
  const anthem=$('#anthem');
  let soundOn=true;
  $('#btnMute').addEventListener('click', async ()=>{
    soundOn=!soundOn; $('#btnMute').setAttribute('aria-pressed', soundOn);
    $('#btnMute').textContent = soundOn? 'üîà Sound':'üîá Muted';
    try{ soundOn ? await anthem.play() : anthem.pause(); }catch{}
  });
  addEventListener('pointerdown', ()=>{ if(soundOn) anthem.play().catch(()=>{}); }, {once:true});

  // ===== Countdown =====
  function tick(){
    const now=new Date(); const year=now.getFullYear();
    const target=new Date(`${year}-08-14T00:00:00`);
    const diff= now<=target? (target-now) : (new Date(`${year+1}-08-14T00:00:00`)-now);
    $('#timer').textContent = `‚è≥ 14 August countdown: ${fmtTime(diff)}`;
  }
  setInterval(tick, 1000); tick();

  // ===== Confetti Canvas =====
  const confetti=document.getElementById('confetti'); const cctx=confetti.getContext('2d');
  const fireworks=document.getElementById('fireworks'); const fctx=fireworks.getContext('2d');
  function resize(){ confetti.width=innerWidth; confetti.height=innerHeight; fireworks.width=innerWidth; fireworks.height=innerHeight; }
  addEventListener('resize', resize); resize();

  const bits=[]; const sparks=[];
  function sprinkle(){
    for(let i=0;i<160;i++){
      bits.push({x:random(0,innerWidth), y:random(-40,-10), w:random(4,8), h:random(8,16), vy:random(1,3), vx:random(-.8,.8), r:random(0,Math.PI), vr:random(-.06,.06), col: Math.random()<.7? '#0a7d44':'#ffffff'});
    }
  }
  function boom(x,y){
    for(let i=0;i<90;i++) sparks.push({x,y, vx:Math.cos(i)*random(-2,2)+(Math.random()-.5)*3, vy:Math.sin(i)*random(-2,2)+(Math.random()-.5)*3, life:random(40,90), age:0, size:random(1.2,2.8), hue:random(110,140)});
  }
  (function step(){ requestAnimationFrame(step);
    // confetti
    cctx.clearRect(0,0,confetti.width,confetti.height);
    bits.forEach(b=>{ b.vy+=0.01; b.x+=b.vx; b.y+=b.vy; b.r+=b.vr; cctx.save(); cctx.translate(b.x,b.y); cctx.rotate(b.r); cctx.fillStyle=b.col; cctx.fillRect(-b.w/2,-b.h/2,b.w,b.h); cctx.restore();});
    for(let i=bits.length-1;i>=0;i--) if(bits[i].y>innerHeight+30) bits.splice(i,1);
    // fireworks
    fctx.clearRect(0,0,fireworks.width,fireworks.height);
    sparks.forEach(s=>{ s.age++; if(s.age>s.life) return; s.vy+=.02; s.x+=s.vx; s.y+=s.vy; const a=1-s.age/s.life; fctx.beginPath(); fctx.arc(s.x,s.y,s.size,0,Math.PI*2); fctx.fillStyle=`hsla(${s.hue},80%,60%,${a})`; fctx.fill(); });
    for(let i=sparks.length-1;i>=0;i--) if(sparks[i].age>sparks[i].life) sparks.splice(i,1);
  })();

  // ===== Hoist Animation =====
  const flag=$('#flag');
  let hoisted=false; let anim=null;
  function hoist(){
    if(hoisted) return; hoisted=true; localStorage.setItem(joinedKey, (++joined).toString()); updateJoinCount();
    $('#cta').style.display='none'; anthem.currentTime=0; if(soundOn) anthem.play().catch(()=>{});
    // animate translateY from current to ~0
    const start=performance.now(); const from=flag._y??52; const to=0; const dur=4200;
    function frame(t){ const p=Math.min(1,(t-start)/dur); const ease=1-Math.pow(1-p,3); const y=from+(to-from)*ease; flag.style.transform=`translateY(${y}%)`; if(p<1){ anim=requestAnimationFrame(frame);} else { onHoisted(); }}
    anim=requestAnimationFrame(frame);
  }
  function preview(){ if(hoisted) return; // preview small bounce
    const start=performance.now(); const base=52; const to=40; const dur=900;
    function frame(t){ const p=Math.min(1,(t-start)/dur); const ease = p<.5? (2*p*p) : (1 - Math.pow(-2*p+2,2)/2); const y=base+(to-base)*ease; flag.style.transform=`translateY(${y}%)`; if(p<1){ requestAnimationFrame(frame);} else { setTimeout(()=> flag.style.transform=`translateY(${base}%)`, 400);} }
    requestAnimationFrame(frame);
  }
  function replay(){ hoisted=false; flag.style.transform='translateY(52%)'; $('#celebrate').classList.remove('show'); $('#cta').style.display='grid'; }
  function onHoisted(){ sprinkle(); for(let i=0;i<4;i++) setTimeout(()=> boom(innerWidth/2, innerHeight*.35), i*500); $('#celebrate').classList.add('show'); location.hash='#celebrate'; }

  // Buttons
  $('#btnHoist').addEventListener('click', hoist);
  $('#btnPreview').addEventListener('click', preview);
  $('#btnReplay').addEventListener('click', replay);
  $('#btnCelebrate').addEventListener('click', ()=>{ sprinkle(); boom(innerWidth/2, innerHeight*.35); });

  // Share
  $('#btnShare').addEventListener('click', async ()=>{
    const text='I hoisted Pakistan\'s flag online! Add your wish üáµüá∞';
    if(navigator.share){ try{ await navigator.share({title:'Virtual Flag Hoisting ‚Äî Pakistan', text, url: location.href}); }catch{} }
    else { await navigator.clipboard.writeText(location.href); alert('Link copied!'); }
  });

  // ===== Wish Wall logic =====
  const grid=$('#grid'); const empty=$('#empty');
  const state={filter:'all', sort:'latest', q:''};

  function render(){
    const list=wishes.filter(w=>{
      if(state.filter!=='all' && w.lang!==state.filter) return false;
      if(state.q){ const s=(w.text+' '+(w.name||'')+' '+(w.city||'')).toLowerCase(); if(!s.includes(state.q)) return false; }
      return true;
    }).sort((a,b)=> state.sort==='latest' ? b.ts-a.ts : (b.hearts||0)-(a.hearts||0));

    grid.innerHTML='';
    list.forEach(w=>{
      const card=document.createElement('article'); card.className='wish'; card.setAttribute('role','listitem'); card.dir=w.lang==='ur'? 'rtl':'ltr';
      const text=document.createElement('div'); text.textContent=w.text;
      const meta=document.createElement('div'); meta.className='metaRow';
      const left=document.createElement('div'); left.textContent=`${w.name||'Anonymous'}${w.city? ' ‚Ä¢ '+w.city:''}`;
      const right=document.createElement('div');
      const heart=document.createElement('button'); heart.className='ghost'; heart.textContent=`‚ù§Ô∏è ${w.hearts||0}`; heart.setAttribute('aria-label','Heart this wish');
      const liked=localStorage.getItem(heartKey(w.id))==='1'; heart.setAttribute('aria-pressed', liked);
      heart.addEventListener('click',()=>{
        const already=localStorage.getItem(heartKey(w.id))==='1';
        if(already){ w.hearts=Math.max(0,(w.hearts||0)-1); localStorage.removeItem(heartKey(w.id)); heart.setAttribute('aria-pressed','false'); }
        else { w.hearts=(w.hearts||0)+1; localStorage.setItem(heartKey(w.id),'1'); heart.setAttribute('aria-pressed','true'); boom(innerWidth/2, innerHeight*.35); }
        heart.textContent=`‚ù§Ô∏è ${w.hearts}`; save(); updateCounts();
      });
      const share=document.createElement('button'); share.className='ghost'; share.textContent='üì§'; share.title='Share this wish';
      share.addEventListener('click', async ()=>{
        const txt=`Wish for Pakistan by ${w.name||'Anonymous'}${w.city? ' from '+w.city:''}: "${w.text}"`;
        if(navigator.share){ try{ await navigator.share({title:'Wish Wall ‚Äî Pakistan', text:txt, url: location.href}); }catch{} }
        else { await navigator.clipboard.writeText(`${txt}\n${location.href}`); alert('Copied!'); }
      });
      right.appendChild(heart); right.appendChild(share);
      meta.appendChild(left); meta.appendChild(right);
      card.appendChild(text); card.appendChild(meta);
      grid.appendChild(card);
    });
    empty.style.display = list.length? 'none':'block';
    updateCounts();
  }

  function save(){ localStorage.setItem(storeKey, JSON.stringify(wishes)); }
  function updateCounts(){
    const total=wishes.length; const hearts=wishes.reduce((a,b)=>a+(b.hearts||0),0);
    $('#wishCount').textContent=`üìù ${total} wishes`; $('#loveCount').textContent=`‚ù§Ô∏è ${hearts} hearts`; $('#footCount').textContent=`üë• ${joined} joined`;
  }

  $('#wishForm').addEventListener('submit', (e)=>{
    e.preventDefault(); const name=$('#name').value.trim(); const text=$('#wish').value.trim(); const city=$('#city').value.trim(); let lang=$('#lang').value; if(!text){ $('#wish').focus(); return; }
    if(lang==='auto') lang=isUrduGuess(text)? 'ur':'en';
    const item={ id:crypto.randomUUID(), name:name||undefined, city:city||undefined, lang, text, hearts:0, ts:Date.now() };
    wishes.unshift(item); save(); $('#wish').value=''; render(); sprinkle();
  });

  $('#btnClear').addEventListener('click',()=>{ if(confirm('This clears wishes stored locally in this browser for this prototype. Proceed?')){ localStorage.removeItem(storeKey); wishes=[]; render(); }});
  $('#filterLang').addEventListener('change', e=>{ state.filter=e.target.value; render(); });
  $('#sortBy').addEventListener('change', e=>{ state.sort=e.target.value; render(); });
  $('#search').addEventListener('input', e=>{ state.q=e.target.value.toLowerCase(); render(); });

  function updateJoinCount(){ $('#counter').textContent=`üë• ${joined} joined`; $('#footCount').textContent=`üë• ${joined} joined`; }

  // Footer year & initial renders
  $('#yr').textContent = new Date().getFullYear();
  updateJoinCount(); render();
</script>
</body>
</html>
